# 3D 뷰어 구현 사양서

## 개요
이 문서는 Bridge BIM Platform의 3D 뷰어에 현재 구현된 교량 구조와 렌더링 방식을 설명합니다.

## 교량 타입
- **교량 종류**: 해상 사장교 (Cable-Stayed Bridge)
- **구조 형식**: 단일 주탑 사장교 (Single Pylon Cable-Stayed Bridge)
- **총 컴포넌트 수**: 18개

## 좌표계
- **X축**: 교량 길이 방향 (좌측: 음수, 우측: 양수)
- **Y축**: 높이 (지면: 0, 위로 양수)
- **Z축**: 교량 폭 방향 (전방: 양수, 후방: 음수)
- **단위**: 미터 (1 unit = 1m)

## 컴포넌트 상세 사양

### 1. 주탑 (Pylon)
- **ID**: `pylon-main`
- **이름**: 주탑
- **타입**: Pylon
- **재료**: Concrete (콘크리트)
- **위치**: 상판 중앙 (X=0 기준)
- **바운딩 박스**:
  - 최소: [-2, 0, -2]
  - 최대: [2, 45, 2]
- **크기**:
  - 높이: 45m
  - 폭: 4m (X 방향)
  - 두께: 4m (Z 방향)
- **상태**: SAFE (초록색)
- **3D 형상**: 원기둥 (CylinderGeometry, 반지름 2m, 높이 45m, 세그먼트 32)

### 2. 상판 (Deck)
- **ID**: `deck-main`
- **이름**: 상판
- **타입**: Deck
- **재료**: Concrete (콘크리트)
- **바운딩 박스**:
  - 최소: [-90, 18, -7]
  - 최대: [90, 19.2, 7]
- **크기**:
  - 길이: 180m (X 방향, -90m ~ +90m)
  - 폭: 14m (Z 방향, -7m ~ +7m)
  - 두께: 1.2m (Y 방향, 18m ~ 19.2m)
- **상태**: SAFE (초록색)
- **3D 형상**: 박스 (BoxGeometry, 180m × 1.2m × 14m)

### 3. 해상 교각 (Piers) - 6개
모든 교각은 동일한 사양을 가집니다:
- **재료**: Concrete (콘크리트)
- **높이**: 18m
- **폭**: 3m (X 방향)
- **두께**: 3m (Z 방향)
- **상태**: 모두 SAFE (초록색)
- **3D 형상**: 원기둥 (CylinderGeometry, 반지름 1.5m, 높이 18m, 세그먼트 32)

#### 교각 배치 (주탑 기준 좌우 대칭, 30m 간격)
- **pier-1** (해상 교각 1)
  - 위치: X = -74m (중심)
  - 바운딩 박스: [-75.5, 0, -1.5] ~ [-72.5, 18, 1.5]
  
- **pier-2** (해상 교각 2)
  - 위치: X = -44m (중심)
  - 바운딩 박스: [-45.5, 0, -1.5] ~ [-42.5, 18, 1.5]
  
- **pier-3** (해상 교각 3)
  - 위치: X = -14m (중심)
  - 바운딩 박스: [-15.5, 0, -1.5] ~ [-12.5, 18, 1.5]
  
- **pier-4** (해상 교각 4)
  - 위치: X = +14m (중심)
  - 바운딩 박스: [12.5, 0, -1.5] ~ [15.5, 18, 1.5]
  
- **pier-5** (해상 교각 5)
  - 위치: X = +44m (중심)
  - 바운딩 박스: [42.5, 0, -1.5] ~ [45.5, 18, 1.5]
  
- **pier-6** (해상 교각 6)
  - 위치: X = +74m (중심)
  - 바운딩 박스: [72.5, 0, -1.5] ~ [75.5, 18, 1.5]

### 4. 사장 케이블 (Cables) - 10개
모든 케이블은 동일한 기본 사양을 가집니다:
- **재료**: Steel (강재)
- **직경**: 0.12m
- **3D 형상**: 원기둥 (CylinderGeometry, 반지름 0.1m, 세그먼트 16)
- **시작점**: 주탑 상단 중앙 [0, 45, 0]
- **연결점**: 상판 상부 (Y=19m)

#### 케이블 배치 (주탑 기준 좌우 대칭, 15m 간격)

**좌측 케이블 (5개)**:
- **cable-1** (사장 케이블 1)
  - 시작점: [0, 45, 0] (주탑 상단 중앙)
  - 끝점: [-75, 19, 0] (상판 좌측)
  - 장력: 4200 kN
  - 상태: WARNING (노란색)
  
- **cable-2** (사장 케이블 2)
  - 시작점: [0, 45, 0]
  - 끝점: [-60, 19, 0]
  - 장력: 4100 kN
  - 상태: SAFE (초록색)
  
- **cable-3** (사장 케이블 3)
  - 시작점: [0, 45, 0]
  - 끝점: [-45, 19, 0]
  - 장력: 4000 kN
  - 상태: SAFE (초록색)
  
- **cable-4** (사장 케이블 4)
  - 시작점: [0, 45, 0]
  - 끝점: [-30, 19, 0]
  - 장력: 3900 kN
  - 상태: SAFE (초록색)
  
- **cable-5** (사장 케이블 5)
  - 시작점: [0, 45, 0]
  - 끝점: [-15, 19, 0]
  - 장력: 3800 kN
  - 상태: SAFE (초록색)

**우측 케이블 (5개)**:
- **cable-6** (사장 케이블 6)
  - 시작점: [0, 45, 0]
  - 끝점: [15, 19, 0]
  - 장력: 3800 kN
  - 상태: SAFE (초록색)
  
- **cable-7** (사장 케이블 7)
  - 시작점: [0, 45, 0]
  - 끝점: [30, 19, 0]
  - 장력: 3900 kN
  - 상태: SAFE (초록색)
  
- **cable-8** (사장 케이블 8)
  - 시작점: [0, 45, 0]
  - 끝점: [45, 19, 0]
  - 장력: 4000 kN
  - 상태: SAFE (초록색)
  
- **cable-9** (사장 케이블 9)
  - 시작점: [0, 45, 0]
  - 끝점: [60, 19, 0]
  - 장력: 4100 kN
  - 상태: SAFE (초록색)
  
- **cable-10** (사장 케이블 10)
  - 시작점: [0, 45, 0]
  - 끝점: [75, 19, 0]
  - 장력: 4200 kN
  - 상태: SAFE (초록색)

#### 케이블 회전 계산
케이블은 대각선으로 배치되며, 다음 공식으로 회전이 계산됩니다:
- **Y축 회전 (수평 방향)**: `atan2(dx, dz)` - XZ 평면에서의 각도
- **X축 회전 (수직 각도)**: `-atan2(dy, horizontalDist)` - 수직 대각선 각도
- `dx = endX - startX`, `dy = endY - startY`, `dz = endZ - startZ`
- `horizontalDist = sqrt(dx² + dz²)`

## 구조 관계 (Relationships)

### 주탑 → 케이블 연결 (10개)
- `pylon-main` → `cable-1` (SUPPORTS)
- `pylon-main` → `cable-2` (SUPPORTS)
- `pylon-main` → `cable-3` (SUPPORTS)
- `pylon-main` → `cable-4` (SUPPORTS)
- `pylon-main` → `cable-5` (SUPPORTS)
- `pylon-main` → `cable-6` (SUPPORTS)
- `pylon-main` → `cable-7` (SUPPORTS)
- `pylon-main` → `cable-8` (SUPPORTS)
- `pylon-main` → `cable-9` (SUPPORTS)
- `pylon-main` → `cable-10` (SUPPORTS)

### 케이블 → 상판 연결 (10개)
- `cable-1` → `deck-main` (SUPPORTS)
- `cable-2` → `deck-main` (SUPPORTS)
- `cable-3` → `deck-main` (SUPPORTS)
- `cable-4` → `deck-main` (SUPPORTS)
- `cable-5` → `deck-main` (SUPPORTS)
- `cable-6` → `deck-main` (SUPPORTS)
- `cable-7` → `deck-main` (SUPPORTS)
- `cable-8` → `deck-main` (SUPPORTS)
- `cable-9` → `deck-main` (SUPPORTS)
- `cable-10` → `deck-main` (SUPPORTS)

### 교각 → 상판 연결 (6개)
- `pier-1` → `deck-main` (SUPPORTS)
- `pier-2` → `deck-main` (SUPPORTS)
- `pier-3` → `deck-main` (SUPPORTS)
- `pier-4` → `deck-main` (SUPPORTS)
- `pier-5` → `deck-main` (SUPPORTS)
- `pier-6` → `deck-main` (SUPPORTS)

**총 관계 수**: 26개

## 3D 렌더링 구현

### Three.js 설정
- **렌더러**: WebGLRenderer (antialias: true)
- **카메라**: PerspectiveCamera (FOV: 75°, near: 0.1, far: 10000)
- **조명**:
  - AmbientLight (색상: 0xffffff, 강도: 0.6)
  - DirectionalLight 1 (위치: [10, 10, 10], 강도: 0.8)
  - DirectionalLight 2 (위치: [-10, 5, -10], 강도: 0.4)
- **컨트롤**: OrbitControls (damping: 0.05, zoom/pan 활성화)
- **배경색**: 0x222222 (어두운 회색)

### 컴포넌트별 3D 형상 생성

#### 주탑 (Pylon) / 교각 (Column)
- **형상**: CylinderGeometry
- **반지름**: 바운딩 박스의 X/Z 중 최대값의 절반
- **높이**: 바운딩 박스의 Y 차이
- **세그먼트**: 32

#### 케이블 (Cable)
- **형상**: CylinderGeometry
- **반지름**: 0.1m (고정)
- **높이**: 시작점과 끝점 사이의 대각선 거리
- **세그먼트**: 16
- **회전**: 시작점과 끝점을 연결하는 대각선 방향으로 자동 회전

#### 상판 (Deck) / 보 (Beam) / 기초 (Foundation)
- **형상**: BoxGeometry
- **크기**: 바운딩 박스의 X, Y, Z 차이

### 상태별 색상
- **SAFE**: 0x16a34a (초록색)
- **WARNING**: 0xca8a04 (노란색)
- **DANGER**: 0xdc2626 (빨간색)
- **기본**: 0x4a90e2 (파란색)

### 재질 속성
- **타입**: MeshStandardMaterial
- **metalness**: 0.3
- **roughness**: 0.7

### 카메라 자동 포커스
모든 컴포넌트 로드 후, 전체 바운딩 박스를 계산하여 카메라를 자동으로 조정합니다:
- **중심점**: 모든 바운딩 박스의 중심
- **거리**: 최대 크기의 2배
- **위치**: 중심점에서 (0.7, 0.5, 0.7) 방향으로 거리만큼 이동

### 선택 하이라이트
선택된 컴포넌트는 emissive 속성이 추가됩니다:
- **emissive 색상**: 0x444444
- **emissive 강도**: 0.5

## 전체 구조 요약

### 공간 배치
- **전체 길이**: 180m (X: -90m ~ +90m)
- **전체 높이**: 45m (Y: 0m ~ 45m)
- **전체 폭**: 14m (Z: -7m ~ +7m)

### 구조적 특징
1. **대칭성**: 주탑(X=0)을 기준으로 좌우 완전 대칭
2. **케이블 간격**: 15m 일정 간격으로 하중 분산
3. **교각 간격**: 30m 일정 간격으로 상판 지지
4. **부채꼴 배치**: 케이블이 주탑 상단에서 방사형으로 퍼짐

### 공학적 검증
- ✅ 주탑이 상판 중앙에 위치
- ✅ 케이블이 주탑 상단 중앙에 고정
- ✅ 케이블이 상판에 일정 간격(15m)으로 연결
- ✅ 교각이 대칭적으로 배치되어 구조 안정성 확보
- ✅ 하중 분산이 균등하게 설계됨

## 렌더링 로그
3D 뷰어는 다음 정보를 콘솔에 출력합니다:
- 렌더링 시작 시 총 부재 수
- 각 부재 추가 시 이름, 타입, 위치
- 케이블 회전 각도 (Y축, X축)
- 모든 부재 렌더링 완료 시 총 메시 수
- 카메라 포커스 완료 시 중심점과 크기
